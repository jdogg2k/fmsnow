<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_g_irm_fms.FMSFinTran</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>FMSFinTran</name>
        <script><![CDATA[var FMSFinTran = Class.create();
FMSFinTran.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {

	allocGrpTable: FMSConstants.TABLE_ALLOCATION_GROUP,
	finTranView: FMSConstants.VIEW_FINANCIAL_TRANSACTION_JOIN,
	finTranTable: FMSConstants.TABLE_FINANCIAL_TRANSACTION,
	tranItemTable: FMSConstants.TABLE_FINANCIAL_TRANSACTION_ITEM,
	FMSUtility: new x_g_irm_fms.FMSUtilities(),              //helper utility for FMS queries
	
    getObligatedTotal: function(grpKey, fy, tranKey) {
        var txn = new GlideRecord(this.finTranView);
		if (tranKey && tranKey != null) { txn.addQuery('ft_sys_id', tranKey); }
		txn.addAggregate('SUM', 'itm_item_total');
        txn.addQuery('ft_void', 0);
        txn.addQuery('ft_fy', fy);
        txn.addQuery('ft_allocation_group_ref', grpKey);
		txn.addQuery('ft_tran_status', 'Obligated');
		txn.orderBy('ft_allocation_group_ref');
		gs.addInfoMessage('quering....')
        txn.query();
		var totAmt = 0;
        while (txn.next()) {
			totAmt += txn.getAggregate('SUM', 'itm_item_total');
		}
		return totAmt;
	},
	
	type: 'FMSFinTran'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>MarkelJR@state.gov</sys_created_by>
        <sys_created_on>2020-07-28 16:48:32</sys_created_on>
        <sys_id>1238d3d91b5ed0101f7e113d9c4bcbd6</sys_id>
        <sys_mod_count>9</sys_mod_count>
        <sys_name>FMSFinTran</sys_name>
        <sys_package display_value="FMS" source="x_g_irm_fms">c728dd331b3fc8100a4a10ad9c4bcbb6</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="FMS">c728dd331b3fc8100a4a10ad9c4bcbb6</sys_scope>
        <sys_update_name>sys_script_include_1238d3d91b5ed0101f7e113d9c4bcbd6</sys_update_name>
        <sys_updated_by>MarkelJR@state.gov</sys_updated_by>
        <sys_updated_on>2020-07-28 18:55:50</sys_updated_on>
    </sys_script_include>
</record_update>
